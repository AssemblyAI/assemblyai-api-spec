openapi: 3.1.0
info:
  title: AAI Chat Completions API
  description: API for generating text with various language models.
  version: 1.0.0
servers:
  - url: https://llm-gateway.assemblyai.com/v1
    description: Production Server
    x-fern-server-name: Production

security:
  - ApiKey: []

paths:
  /chat/completions:
    post:
      x-fern-sdk-group-name: LLM Gateway
      x-fern-display-name: Chat completions
      summary: Create a chat completion
      description: Generates a response from a model given a prompt or a series of messages.
      operationId: createChatCompletion
      requestBody:
        description: Request body for creating a chat completion.
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LLMGatewayRequest"
            examples:
              messages_example:
                summary: Chat with messages
                value:
                  model: "claude-sonnet-4-5-20250929"
                  messages:
                    - role: "user"
                      content: "Hello, how are you?"
                  max_tokens: 100
                  temperature: 0.7
              prompt_example:
                summary: Simple prompt
                value:
                  model: "claude-sonnet-4-5-20250929"
                  prompt: "Write a haiku about coding"
                  max_tokens: 50
                  temperature: 0.5
      responses:
        "200":
          description: Successful response containing the model's choices.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Response"
        default:
          description: An unexpected error occurred.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /understanding:
    post:
      x-fern-sdk-group-name: LLM Gateway
      x-fern-display-name: Speech Understanding
      summary: Process speech understanding
      description: Perform various speech understanding tasks like translation, speaker identification, and custom formatting.
      operationId: createSpeechUnderstanding
      requestBody:
        description: Request body for speech understanding tasks.
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UnderstandingRequest"
            examples:
              translation_example:
                summary: Translation request
                value:
                  transcript_id: "12345"
                  speech_understanding:
                    request:
                      translation:
                        target_languages: ["es", "de"]
                        formal: true
                        # match_original_utterance: true
              speaker_identification_example:
                summary: Speaker identification request
                value:
                  transcript_id: "12345"
                  speech_understanding:
                    request:
                      speaker_identification:
                        speaker_type: "role"
                        known_values: ["interviewer", "candidate"]
              custom_formatting_example:
                summary: Custom formatting request
                value:
                  transcript_id: "12345"
                  speech_understanding:
                    request:
                      custom_formatting:
                        date: "mm/dd/yyyy"
                        phone_number: "(xxx)xxx-xxxx"
                        email: "username@domain.com"
                        format_utterances: true
      responses:
        "200":
          description: Successful response containing the speech understanding results.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/LLMGatewayTranslationResponse"
                  - $ref: "#/components/schemas/LLMGatewaySpeakerIdentificationResponse"
                  - $ref: "#/components/schemas/LLMGatewayCustomFormattingResponse"
        default:
          description: An unexpected error occurred.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  schemas:
    # Request Schemas
    LLMGatewayRequest:
      type: object
      description: The main request body for the chat completions endpoint.
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/Message"
          description: A list of messages comprising the conversation so far.
        prompt:
          type: string
          description: A simple string prompt. The API will automatically convert this into a user message.
        model:
          type: string
          description: The ID of the model to use for this request.
          examples: ["claude-sonnet-4-5-20250929"]
        max_tokens:
          type: integer
          minimum: 1
          description: The maximum number of tokens to generate in the completion.
        temperature:
          type: number
          format: float
          minimum: 0.0
          maximum: 2.0
          description: Controls randomness. Lower values produce more deterministic results.
        tools:
          type: array
          items:
            $ref: "#/components/schemas/Tool"
          description: A list of tools the model may call.
        tool_choice:
          $ref: "#/components/schemas/ToolChoice"
      required:
        - model

    Message:
      oneOf:
        - $ref: "#/components/schemas/UserAssistantSystemMessage"
        - $ref: "#/components/schemas/ToolMessage"
      discriminator:
        propertyName: role
        mapping:
          user: "#/components/schemas/UserAssistantSystemMessage"
          assistant: "#/components/schemas/UserAssistantSystemMessage"
          system: "#/components/schemas/UserAssistantSystemMessage"
          tool: "#/components/schemas/ToolMessage"

    UserAssistantSystemMessage:
      type: object
      properties:
        role:
          type: string
          enum: [user, assistant, system]
        content:
          oneOf:
            - type: string
            - type: array
              items:
                $ref: "#/components/schemas/ContentPart"
          description: The content of the message. Can be a string or an array of content parts (for user messages).
        name:
          type: string
          description: An optional name for the participant.
      required:
        - role
        - content

    ToolMessage:
      type: object
      properties:
        role:
          type: string
          enum: [tool]
        content:
          type: string
          description: The result of the tool call.
        tool_call_id:
          type: string
          description: The ID of the tool call that this message is responding to.
      required:
        - role
        - content
        - tool_call_id

    ContentPart:
      description: Currently only supports text content parts.
      $ref: "#/components/schemas/TextContent"

    TextContent:
      type: object
      properties:
        type:
          type: string
          enum: [text]
        text:
          type: string
      required:
        - type
        - text

    Tool:
      type: object
      properties:
        type:
          type: string
          enum: [function]
        function:
          $ref: "#/components/schemas/FunctionDescription"
      required:
        - type
        - function

    FunctionDescription:
      type: object
      properties:
        name:
          type: string
          description: The name of the function to be called.
        description:
          type: string
          description: A description of what the function does.
        parameters:
          type: object
          description: A JSON Schema object describing the parameters the function accepts.
          additionalProperties: true
      required:
        - name
        - parameters

    ToolChoice:
      oneOf:
        - type: string
          enum: [none, auto]
        - type: object
          properties:
            type:
              type: string
              enum: [function]
            function:
              type: object
              properties:
                name:
                  type: string
              required:
                - name
          required:
            - type
            - function
      description: Controls which (if any) function is called by the model.

    # Response Schemas
    Response:
      type: object
      properties:
        request_id:
          type: string
          format: uuid
        choices:
          type: array
          items:
            $ref: "#/components/schemas/Choice"
        request:
          type: object
          description: A copy of the original request, excluding `prompt` and `messages`.
          properties:
            model:
              type: string
            max_tokens:
              type: integer
            temperature:
              type: number
            tools:
              type: array
              items:
                $ref: "#/components/schemas/Tool"
            tool_choice:
              $ref: "#/components/schemas/ToolChoice"
        usage:
          $ref: "#/components/schemas/Usage"
        http_status_code:
          type: integer
          description: The HTTP status code of the response
          example: 200
        response_time:
          type: integer
          description: The response time in nanoseconds
          example: 275510459
        llm_status_code:
          type: integer
          description: The status code from the LLM provider
          example: 200

    Choice:
      type: object
      properties:
        message:
          $ref: "#/components/schemas/ResponseMessage"
        finish_reason:
          type: string
          description: The reason the model stopped generating tokens.
          examples: ["stop"]
        tool_calls:
          type: array
          items:
            $ref: "#/components/schemas/FunctionToolCall"

    ResponseMessage:
      type: object
      properties:
        role:
          type: string
        content:
          type: string

    FunctionToolCall:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [function]
        function:
          $ref: "#/components/schemas/FunctionCall"
      required:
        - id
        - type
        - function

    FunctionCall:
      type: object
      properties:
        name:
          type: string
        arguments:
          type: string
          description: The arguments to call the function with, as a JSON-formatted string.
      required:
        - name
        - arguments

    Usage:
      type: object
      properties:
        prompt_tokens:
          type: integer
        completion_tokens:
          type: integer
        total_tokens:
          type: integer
      required:
        - prompt_tokens
        - completion_tokens
        - total_tokens

    # Understanding Request/Response Schemas
    UnderstandingRequest:
      type: object
      properties:
        transcript_id:
          type: string
          description: The ID of the transcript to process.
        speech_understanding:
          type: object
          properties:
            request:
              oneOf:
                - $ref: "#/components/schemas/TranslationRequestBody"
                - $ref: "#/components/schemas/SpeakerIdentificationRequestBody"
                - $ref: "#/components/schemas/CustomFormattingRequestBody"
          required:
            - request
      required:
        - transcript_id
        - speech_understanding

    TranslationRequestBody:
      type: object
      properties:
        translation:
          type: object
          properties:
            target_languages:
              type: array
              items:
                type: string
              description: List of target language codes (e.g., `["es", "de"]`)
            formal:
              type: boolean
              description: Use formal language style
              default: true
            # match_original_utterance:
            #   type: boolean
            #   description: Get translated utterances (if speaker_labels was enabled)
            #   default: false
          required:
            - target_languages
      required:
        - translation

    SpeakerIdentificationRequestBody:
      type: object
      properties:
        speaker_identification:
          type: object
          properties:
            speaker_type:
              type: string
              enum: [role, name]
              description: Type of speaker identification
            known_values:
              type: array
              items:
                type: string
              description: Required if speaker_type is "role"
          required:
            - speaker_type
      required:
        - speaker_identification

    CustomFormattingRequestBody:
      type: object
      properties:
        custom_formatting:
          type: object
          properties:
            date:
              type: string
              description: Date format pattern (e.g., `"mm/dd/yyyy"`)
            phone_number:
              type: string
              description: Phone number format pattern (e.g., `"(xxx)xxx-xxxx"`)
            email:
              type: string
              description: Email format pattern (e.g., `"username@domain.com"`)
            format_utterances:
              type: boolean
              description: Whether to format utterances
              default: true
      required:
        - custom_formatting

    LLMGatewayTranslationResponse:
      type: object
      properties:
        speech_understanding:
          type: object
          properties:
            request:
              $ref: "#/components/schemas/TranslationRequestBody"
            response:
              type: object
              properties:
                translation:
                  type: object
                  properties:
                    status:
                      type: string
        translated_texts:
          type: object
          description: 'Translated text keyed by language code (e.g., `{"es": "Texto traducido"}`)'
          # Unsure how to display dynamic keys.

        utterances:
          type: array
          items:
            type: object
        words:
          type: array
          items:
            type: object

    LLMGatewaySpeakerIdentificationResponse:
      type: object
      properties:
        speech_understanding:
          type: object
          properties:
            request:
              $ref: "#/components/schemas/SpeakerIdentificationRequestBody"
            response:
              type: object
              properties:
                speaker_identification:
                  type: object
                  properties:
                    status:
                      type: string
                  required:
                    - status
        utterances:
          type: array
          items:
            type: object
        words:
          type: array
          items:
            type: object

    LLMGatewayCustomFormattingResponse:
      type: object
      properties:
        speech_understanding:
          type: object
          properties:
            request:
              $ref: "#/components/schemas/CustomFormattingRequestBody"
            response:
              type: object
              properties:
                custom_formatting:
                  type: object
                  properties:
                    mapping:
                      type: object
                      additionalProperties:
                        type: string
                    formatted_text:
                      type: string
                    formatted_utterances:
                      type: array
                      items:
                        type: object
                    status:
                      type: string
                  required:
                    - mapping
                    - formatted_text
                    - formatted_utterances
                    - status
        utterances:
          type: array
          items:
            type: object

    # Error Schema
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              format: int32
            message:
              type: string
            metadata:
              type: object
              additionalProperties: true
          required:
            - code
            - message

  securitySchemes:
    ApiKey:
      type: apiKey
      in: header
      name: Authorization
