---
title: "Streaming API: Message Sequence Breakdown"
hide-nav-links: true
description: "The anatomy of an utterance from partial words to finalized utterance to formatted transcript"
---

<Note>
  For a description of each message field, refer to our [Turn
  object](/docs/speech-to-text/universal-streaming#turn-object) explanation.
</Note>

For this example, we are going to walk through a user saying:
`Hi my name is Sonny. I am a voice agent.`

## Session initialization
When the session begins you will get a message indicating the session ID and expiration time.
```json
{
  "type": "Begin",
  "id": "de5d9927-73a6-4be8-b52d-b4c07be37e6b",
  "expires_at": 1759796682
}
```

## Initial utterance and turn

### Start of utterance (Partial transcript), and Start of turn
The user begins saying `Hi my name is Sonny`. Each message return finalizes words as they come through. Finalized words appear in the `transcript` field.
```json
{
  "turn_order": 0,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "",
  "end_of_turn_confidence": 0.017454,
  "words": [
    {
      "start": 1920,
      "end": 2000,
      "text": "hi",
      "confidence": 0.874618,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 0,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "hi",
  "end_of_turn_confidence": 1.4e-05,
  "words": [
    {
      "start": 1920,
      "end": 2000,
      "text": "hi",
      "confidence": 0.874618,
      "word_is_final": true
    },
    {
      "start": 2800,
      "end": 2880,
      "text": "my",
      "confidence": 0.812831,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 0,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "hi my",
  "end_of_turn_confidence": 0.001037,
  "words": [
    {
      "start": 1920,
      "end": 2000,
      "text": "hi",
      "confidence": 0.874618,
      "word_is_final": true
    },
    {
      "start": 2800,
      "end": 2880,
      "text": "my",
      "confidence": 0.812831,
      "word_is_final": true
    },
    {
      "start": 2960,
      "end": 3040,
      "text": "name",
      "confidence": 0.999999,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 0,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "hi my name",
  "end_of_turn_confidence": 0.001456,
  "words": [
    {
      "start": 1920,
      "end": 2000,
      "text": "hi",
      "confidence": 0.874618,
      "word_is_final": true
    },
    {
      "start": 2800,
      "end": 2880,
      "text": "my",
      "confidence": 0.812831,
      "word_is_final": true
    },
    {
      "start": 2960,
      "end": 3040,
      "text": "name",
      "confidence": 0.999999,
      "word_is_final": true
    },
    {
      "start": 3040,
      "end": 3120,
      "text": "is",
      "confidence": 0.795226,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 0,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "hi my name is",
  "end_of_turn_confidence": 0.00545,
  "words": [
    {
      "start": 1920,
      "end": 2000,
      "text": "hi",
      "confidence": 0.874618,
      "word_is_final": true
    },
    {
      "start": 2800,
      "end": 2880,
      "text": "my",
      "confidence": 0.812831,
      "word_is_final": true
    },
    {
      "start": 2960,
      "end": 3040,
      "text": "name",
      "confidence": 0.999999,
      "word_is_final": true
    },
    {
      "start": 3040,
      "end": 3120,
      "text": "is",
      "confidence": 0.795226,
      "word_is_final": true
    },
    {
      "start": 3600,
      "end": 3680,
      "text": "son",
      "confidence": 0.701546,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 0,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "hi my name is",
  "end_of_turn_confidence": 0.057058,
  "words": [
    {
      "start": 1920,
      "end": 2000,
      "text": "hi",
      "confidence": 0.874618,
      "word_is_final": true
    },
    {
      "start": 2800,
      "end": 2880,
      "text": "my",
      "confidence": 0.812831,
      "word_is_final": true
    },
    {
      "start": 2960,
      "end": 3040,
      "text": "name",
      "confidence": 0.999999,
      "word_is_final": true
    },
    {
      "start": 3040,
      "end": 3120,
      "text": "is",
      "confidence": 0.795226,
      "word_is_final": true
    },
    {
      "start": 3600,
      "end": 3840,
      "text": "sonny",
      "confidence": 0.822963,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

### End of utterance (Final transcript), and End of turn
When the utterance is completed, the turn may or may not be predicted to end (this depends entirely on the `end_of_turn_confidence` value). Since the utterance is complete, we push the utterance value to the `utterance` key so you can process it for pre-emptive generation. This is especially useful to get the fastest possible return from our streaming STT model.

In this case, the turn also ends `"end_of_turn":True` since `end_of_turn_confidence` is greater than `0.5`. If the turn confidence was higher, the turn will end later - see [End of utterance (Final Transcript), not End of turn](#end-of-utterance-final-transcript-not-end-of-turn) section below.
```json
{
  "turn_order": 0,
  "turn_is_formatted": false,
  "end_of_turn": true,
  "transcript": "hi my name is sonny",
  "end_of_turn_confidence": 0.5005,
  "words": [
    {
      "start": 1920,
      "end": 2000,
      "text": "hi",
      "confidence": 0.874618,
      "word_is_final": true
    },
    {
      "start": 2800,
      "end": 2880,
      "text": "my",
      "confidence": 0.812831,
      "word_is_final": true
    },
    {
      "start": 2960,
      "end": 3040,
      "text": "name",
      "confidence": 0.999999,
      "word_is_final": true
    },
    {
      "start": 3040,
      "end": 3120,
      "text": "is",
      "confidence": 0.795226,
      "word_is_final": true
    },
    {
      "start": 3600,
      "end": 3840,
      "text": "sonny",
      "confidence": 0.822963,
      "word_is_final": true
    }
  ],
  "utterance": "Hi my name is sonny",
  "type": "Turn"
}
```

### End of turn formatting
Once the turn ends, if formatting is enabled there will be an additional message where `"turn_is_formatted":True` comes back. This will format the final message.

Since LLMs can parse unformatted text, waiting for this message is NOT recommended for voice agents as it adds additional latency. It is recommended for other use cases like closed captioning where the transcript will be displayed to the end user.

```json
{
  "turn_order": 0,
  "turn_is_formatted": true,
  "end_of_turn": true,
  "transcript": "Hi, my name is Sonny.",
  "end_of_turn_confidence": 0.5005,
  "words": [
    {
      "start": 1920,
      "end": 2000,
      "text": "Hi,",
      "confidence": 0.874618,
      "word_is_final": true
    },
    {
      "start": 2800,
      "end": 2880,
      "text": "my",
      "confidence": 0.812831,
      "word_is_final": true
    },
    {
      "start": 2960,
      "end": 3040,
      "text": "name",
      "confidence": 0.999999,
      "word_is_final": true
    },
    {
      "start": 3040,
      "end": 3120,
      "text": "is",
      "confidence": 0.795226,
      "word_is_final": true
    },
    {
      "start": 3600,
      "end": 3840,
      "text": "Sonny.",
      "confidence": 0.822963,
      "word_is_final": true
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

## Additional utterance(s) and turn(s)

### Start of a new utterance (Partial transcript), and Start of a new turn

In this case, the user is not actually done speaking yet. Normally you would have a VAD set up to cancel the end of turn above and let the user keep speaking even though End of Turn was predicted. The user now continues to speak `I am a voice agent.`

```json
{
  "turn_order": 1,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "",
  "end_of_turn_confidence": 7.1e-05,
  "words": [
    {
      "start": 5200,
      "end": 5280,
      "text": "i",
      "confidence": 0.561945,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 1,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "i",
  "end_of_turn_confidence": 0.001201,
  "words": [
    {
      "start": 5200,
      "end": 5280,
      "text": "i",
      "confidence": 0.561945,
      "word_is_final": true
    },
    {
      "start": 5440,
      "end": 5520,
      "text": "am",
      "confidence": 0.804111,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 1,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "i am",
  "end_of_turn_confidence": 1e-05,
  "words": [
    {
      "start": 5200,
      "end": 5280,
      "text": "i",
      "confidence": 0.561945,
      "word_is_final": true
    },
    {
      "start": 5440,
      "end": 5520,
      "text": "am",
      "confidence": 0.804111,
      "word_is_final": true
    },
    {
      "start": 5600,
      "end": 5680,
      "text": "a",
      "confidence": 0.998217,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 1,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "i am a",
  "end_of_turn_confidence": 0.00727,
  "words": [
    {
      "start": 5200,
      "end": 5280,
      "text": "i",
      "confidence": 0.561945,
      "word_is_final": true
    },
    {
      "start": 5440,
      "end": 5520,
      "text": "am",
      "confidence": 0.804111,
      "word_is_final": true
    },
    {
      "start": 5600,
      "end": 5680,
      "text": "a",
      "confidence": 0.998217,
      "word_is_final": true
    },
    {
      "start": 5680,
      "end": 5760,
      "text": "voice",
      "confidence": 0.910144,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 1,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "i am a voice",
  "end_of_turn_confidence": 0.000474,
  "words": [
    {
      "start": 5200,
      "end": 5280,
      "text": "i",
      "confidence": 0.561945,
      "word_is_final": true
    },
    {
      "start": 5440,
      "end": 5520,
      "text": "am",
      "confidence": 0.804111,
      "word_is_final": true
    },
    {
      "start": 5600,
      "end": 5680,
      "text": "a",
      "confidence": 0.998217,
      "word_is_final": true
    },
    {
      "start": 5680,
      "end": 5760,
      "text": "voice",
      "confidence": 0.910144,
      "word_is_final": true
    },
    {
      "start": 5920,
      "end": 6000,
      "text": "agen",
      "confidence": 0.955449,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

```json
{
  "turn_order": 1,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "i am a voice",
  "end_of_turn_confidence": 0.332227,
  "words": [
    {
      "start": 5200,
      "end": 5280,
      "text": "i",
      "confidence": 0.561945,
      "word_is_final": true
    },
    {
      "start": 5440,
      "end": 5520,
      "text": "am",
      "confidence": 0.804111,
      "word_is_final": true
    },
    {
      "start": 5600,
      "end": 5680,
      "text": "a",
      "confidence": 0.998217,
      "word_is_final": true
    },
    {
      "start": 5680,
      "end": 5760,
      "text": "voice",
      "confidence": 0.910144,
      "word_is_final": true
    },
    {
      "start": 5920,
      "end": 6080,
      "text": "agent",
      "confidence": 0.970552,
      "word_is_final": false
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

### End of utterance (Final Transcript), not End of turn
In many cases, the turn may not end but we will have finalized an utterance. For this reason, we supply the `utterances` param to finalize each utterance as fast as possible for downstream LLM pre-emptive generation.

<Note>
If you're using a voice agent provider like [LiveKit](https://www.assemblyai.com/docs/voice-agents/livekit-intro-guide) or [Pipecat](https://www.assemblyai.com/docs/voice-agents/pipecat-intro-guide), this logic is pre-configured for you with the fastest performance settings.
</Note>

```json
{
  "turn_order": 1,
  "turn_is_formatted": false,
  "end_of_turn": false,
  "transcript": "i am a voice",
  "end_of_turn_confidence": 0.454477,
  "words": [
    {
      "start": 5200,
      "end": 5280,
      "text": "i",
      "confidence": 0.561945,
      "word_is_final": true
    },
    {
      "start": 5440,
      "end": 5520,
      "text": "am",
      "confidence": 0.804111,
      "word_is_final": true
    },
    {
      "start": 5600,
      "end": 5680,
      "text": "a",
      "confidence": 0.998217,
      "word_is_final": true
    },
    {
      "start": 5680,
      "end": 5760,
      "text": "voice",
      "confidence": 0.910144,
      "word_is_final": true
    },
    {
      "start": 5920,
      "end": 6080,
      "text": "agent",
      "confidence": 0.970552,
      "word_is_final": false
    }
  ],
  "utterance": "I am a voice agent.",
  "type": "Turn"
}
```

### End of turn, after End of utterance

Once the confidence score of `0.5` is passed for End of Turn, we will end the turn.

```json
{
  "turn_order": 1,
  "turn_is_formatted": false,
  "end_of_turn": true,
  "transcript": "i am a voice agent",
  "end_of_turn_confidence": 0.750889,
  "words": [
    {
      "start": 5200,
      "end": 5280,
      "text": "i",
      "confidence": 0.561945,
      "word_is_final": true
    },
    {
      "start": 5440,
      "end": 5520,
      "text": "am",
      "confidence": 0.804111,
      "word_is_final": true
    },
    {
      "start": 5600,
      "end": 5680,
      "text": "a",
      "confidence": 0.998217,
      "word_is_final": true
    },
    {
      "start": 5680,
      "end": 5760,
      "text": "voice",
      "confidence": 0.910144,
      "word_is_final": true
    },
    {
      "start": 5920,
      "end": 6080,
      "text": "agent",
      "confidence": 0.970552,
      "word_is_final": true
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

### End of turn formatting

Lastly we will format the transcript if formatting is enabled. Again this is only recommended for use cases where the end user will be shown the transcript as it adds some latency for voice agents.

```json
{
  "turn_order": 1,
  "turn_is_formatted": true,
  "end_of_turn": true,
  "transcript": "I am a voice agent.",
  "end_of_turn_confidence": 0.750889,
  "words": [
    {
      "start": 5200,
      "end": 5280,
      "text": "I",
      "confidence": 0.561945,
      "word_is_final": true
    },
    {
      "start": 5440,
      "end": 5520,
      "text": "am",
      "confidence": 0.804111,
      "word_is_final": true
    },
    {
      "start": 5600,
      "end": 5680,
      "text": "a",
      "confidence": 0.998217,
      "word_is_final": true
    },
    {
      "start": 5680,
      "end": 5760,
      "text": "voice",
      "confidence": 0.910144,
      "word_is_final": true
    },
    {
      "start": 5920,
      "end": 6080,
      "text": "agent.",
      "confidence": 0.970552,
      "word_is_final": true
    }
  ],
  "utterance": "",
  "type": "Turn"
}
```

## Best practices

### Voice agents
- Grab the `utterance` parameter as soon as it is available for the fastest STT model response. This is particularly useful if you are using an external Turn Detection model. You can read more about [configuring for third-party turn detection here](https://www.assemblyai.com/docs/speech-to-text/universal-streaming/turn-detection#disable-turn-detection).
  - If you are using AssemblyAI's turn detection, you can simply configure your settings to be [Aggressive](https://www.assemblyai.com/docs/speech-to-text/universal-streaming/turn-detection#aggressive), [Balanced](https://www.assemblyai.com/docs/speech-to-text/universal-streaming/turn-detection#balanced), or [Conservative](https://www.assemblyai.com/docs/speech-to-text/universal-streaming/turn-detection#conservative).
- Avoid using `format_turns` as it will significantly increase latency. LLMs don't need formatting so you can just pass raw text as soon as its ready.
- Utilize the `end_of_turn` parameter to determine when a user is likely to end their turn. Combined with a VAD you can determine if the user is continuing to speak, or if the turn has ended and you can safely interrupt with your voice agent.
  - Note that AssemblyAI has a built-in VAD to the model. If you modify `min_end_of_turn_silence_when_confident` latency will increase but you can substitute the model entirely for a VAD.

### Notetakers and Closed captioning
- Utilize `format_turns` since text will be displayed to the end user and this will make it human-readable. The added latency will be less noticeable to the human eye in these applications.
- Utilize `keyterms_prompt` to increase the accuracy of rare words and entities. Again since the text will be shown to the end user this will improve their perception of accuracy.
