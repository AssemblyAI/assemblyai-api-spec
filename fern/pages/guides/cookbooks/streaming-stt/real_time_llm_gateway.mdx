---
title: "Use LLM Gateway with Streaming Speech-to-Text (STT)"
---

This script is modified to contain a global variable `conversation_data` that accumulates the transcribed text in the `on_message` function. Once the transcription session is closed, the `conversation_data` is sent to LLM Gateway for analysis.

## Quickstart

<Code src="snippets/guides/cookbooks/streaming-stt/real_time_llm_gateway/python-1.py" />
## Step-by-Step Instructions

Before we begin, make sure you have an AssemblyAI account and an API key. You can [sign up](https://assemblyai.com/dashboard/signup) and get your API key from your dashboard.

### Import Packages & Set API Key

<Code src="snippets/guides/cookbooks/streaming-stt/real_time_llm_gateway/python-2.py" />
### Audio Configuration & Global Variables

Set all of your audio configurations and global variables. Make sure that you have the parameter `format_turns` set to `True` and a global variable `conversation_data` set to an empty string `""`.

<Code
  src="snippets/guides/cookbooks/streaming-stt/real_time_llm_gateway/python-3.py"
  highlight={[3, 20]}
/>
### Define Analyze With LLM Gateway Function

Define a function called `analyze_with_llm_gateway`, which uses LLM Gateway to analyze the complete final transcript text. The `prompt` can be modified to suit your individual requirements.

<Code src="snippets/guides/cookbooks/streaming-stt/real_time_llm_gateway/python-4.py" />
### Websocket Event Handlers

#### Open Websocket

<Code src="snippets/guides/cookbooks/streaming-stt/real_time_llm_gateway/python-5.py" />
#### Handle Websocket Messages

In this function, use the previously defined `conversation_data` to store all final transcripts together for later analysis.

<Code
  src="snippets/guides/cookbooks/streaming-stt/real_time_llm_gateway/python-6.py"
  highlight={[15, 19]}
/>
#### Close Websocket

<Code src="snippets/guides/cookbooks/streaming-stt/real_time_llm_gateway/python-7.py" />
#### Websocket Error Handling

<Code src="snippets/guides/cookbooks/streaming-stt/real_time_llm_gateway/python-8.py" />
### Begin Streaming STT Transcription

After the socket is closed, `conversation_data` is sent to the `analyze_with_llm_gateway` function and the LLM Gateway results are printed out.

<Code
  src="snippets/guides/cookbooks/streaming-stt/real_time_llm_gateway/python-9.py"
  highlight={[67 - 71]}
/>
